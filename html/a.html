<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:300m,500,800" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <style>
        body{min-height:100vh;display:flex;align-items: center;justify-content:center;}.text-dark-green{color:#709150}.text-light-green{color:#a1c362}.text-thir{color:#666}.f-1{font-size:.25rem!important}.lh-1{line-height:.25rem!important}.f-2{font-size:.5rem!important}.lh-2{line-height:.5rem!important}.f-3{font-size:.75rem!important}.lh-3{line-height:.75rem!important}.f-4{font-size:1rem!important}.lh-4{line-height:1rem!important}.f-5{font-size:1.25rem!important}.lh-5{line-height:1.25rem!important}.f-6{font-size:1.5rem!important}.lh-6{line-height:1.5rem!important}.f-7{font-size:1.75rem!important}.lh-7{line-height:1.75rem!important}.f-8{font-size:2rem!important}.lh-8{line-height:2rem!important}.f-9{font-size:2.25rem!important}.lh-9{line-height:2.25rem!important}.f-10{font-size:2.5rem!important}.lh-10{line-height:2.5rem!important}.f-11{font-size:2.75rem!important}.lh-11{line-height:2.75rem!important}.f-12{font-size:3rem!important}.lh-12{line-height:3rem!important}.f-13{font-size:3.25rem!important}.lh-13{line-height:3.25rem!important}.f-14{font-size:3.5rem!important}.lh-14{line-height:3.5rem!important}.f-15{font-size:3.75rem!important}.lh-15{line-height:3.75rem!important}.f-16{font-size:4rem!important}.lh-16{line-height:4rem!important}.f-17{font-size:4.25rem!important}.lh-17{line-height:4.25rem!important}.f-18{font-size:4.5rem!important}.lh-18{line-height:4.5rem!important}.f-19{font-size:4.75rem!important}.lh-19{line-height:4.75rem!important}.f-20{font-size:5rem!important}.lh-20{line-height:5rem!important}.f-21{font-size:5.25rem!important}.lh-21{line-height:5.25rem!important}.f-22{font-size:5.5rem!important}.lh-22{line-height:5.5rem!important}.f-23{font-size:5.75rem!important}.lh-23{line-height:5.75rem!important}.f-24{font-size:6rem!important}.lh-24{line-height:6rem!important}.f-25{font-size:6.25rem!important}.lh-25{line-height:6.25rem!important}.text-gradient{display:inline-block;background:linear-gradient(135deg,#709150,#a1c362);-webkit-background-clip:text;color:transparent}*{letter-spacing:.3px}body{font-family:Montserrat,sans-serif;background-color:#fff;margin:0;overflow-x:hidden}button,input,select,textarea{outline:0!important;box-shadow:none!important}button:focus,button:hover,input:focus,input:hover,select:focus,select:hover,textarea:focus,textarea:hover{outline:0!important;box-shadow:none!important}button:focus:focus,button:hover:focus,input:focus:focus,input:hover:focus,select:focus:focus,select:hover:focus,textarea:focus:focus,textarea:hover:focus{border-color:#a1c362!important}.bg-dark-green{background-color:#709150}.text-dark-green{color:#709150}.linear-bg-dark-green{background:linear-gradient(135deg,#709150,#4a6035)}.border-dark-green{border-color:#709150!important}.bg-light-green{background-color:#a1c362}.text-light-green{color:#a1c362}.linear-bg-light-green{background:linear-gradient(135deg,#a1c362,#7b9d3c)}.border-light-green{border-color:#a1c362!important}.bg-thir{background-color:#666}.text-thir{color:#666}.linear-bg-thir{background:linear-gradient(135deg,#666,#404040)}.border-thir{border-color:#666!important}.navbar-nav a{color:#a1c362!important}.navbar-nav a.active,.navbar-nav a:hover{color:#709150!important}.click{cursor:pointer}.op-md{opacity:.5}.op-sm{opacity:.25}.op-xs{opacity:0}.z-1{box-shadow:0 1.5px 1.5px #00000022}.z-2{box-shadow:1px 3px 3px #00000022}.z-3{box-shadow:2px 4.5px 4.5px #00000022}.z-4{box-shadow:3px 6px 6px #00000022}.z-5{box-shadow:4px 7.5px 7.5px #00000022}
    </style>

    <link rel="shortcut icon" href="http://dashboard-amee.herokuapp.com//favicon.ico">
    <title> Cadastro de Aparelho </title>
</head>
<body>
    <form autocomplete="off" id="save-credentials" class="border p-4 mx-4 f-3" style="width: 400px; box-shadow: 0px 3px 6px #00000022">
        <h4 class="text-uppercase text-gradient mb-4"> Cadastro de Aparelho </h4>

        <p class="small text-secondary text-justify"> * Para uma medição mais precisa, os campos de Tensão e Potência podem ser preenchidos, embora não sejam obrigatórios! </p>

        <div class="form-group mb-3">
            <label class="mb-0" for="ssid"> SSID (NOME) DA REDE* </label>
            <input autocomplete="off" type="text" class="form-control" id="ssid" />
        </div>

        <div class="form-group mb-3">
            <label class="mb-0" for="pass"> SENHA DA REDE* </label>
            <input autocomplete="off" type="text" class="form-control" id="pass" />
        </div>

        <div class="form-group mb-3">
            <label class="mb-0" for="name"> Nome do Aparalho* </label>
            <input autocomplete="off" type="text" class="form-control" id="name" />
        </div>

        <div class="form-group mb-3">
            <label class="mb-0" for="tension"> Tensão de Operação do Aparelho </label>
            <input autocomplete="off" type="text" class="form-control" id="tension" />
        </div>

        <div class="form-group mb-0">
            <label class="mb-0" for="power"> Potência do Aparelho </label>
            <input autocomplete="off" type="text" class="form-control" id="power" />
        </div>

        <span class="invisible d-block text-center my-2 d-flex align-items-center justify-content-center" id="response" style="height: 30px; font-size: 12px; line-height: 1.2px"> Carregando... </span>

        <button type="submit" class="btn btn-success w-100"> Enviar </button>
    </form>

    <script>
        document.querySelector("#save-credentials").addEventListener("submit", e => {
            e.preventDefault()

            const ssid = e.target[0].value
            const pass = e.target[1].value
            const name = e.target[2].value
            const tension = e.target[3].value
            const power = e.target[4].value

            const respEl = document.getElementById("response")

            if (ssid.length < 1 || pass.length < 1 || name.length < 1) {
                respEl.classList.remove('invisible')
                respEl.classList.add('text-danger')
                respEl.innerHTML = "Por favor, preencha todos os campos com *"

                return
            }            

            const xmlHttp = new XMLHttpRequest();
            xmlHttp.onreadystatechange = function () {
                respEl.classList.remove('text-danger')
                respEl.classList.remove('invisible')
                respEl.innerHTML = "Configurando módulo..."

                if (this.readyState < 3 || this.readyState > 4) return;

                if (this.readyState === 3) {
                    respEl.innerHTML = "Tentando conectar-se à rede..."   
                }

                if (this.readyState === 4) {
                    if (this.status === 200) {
                        if (this.responseText.includes("error")) {
                            respEl.classList.add('text-danger')
                            respEl.innerHTML = "Incapaz de conectar à sua rede, revise os dados de login!"

                            return
                        }

                        respEl.classList.remove('text-danger')
                        respEl.classList.add('text-success')
                        respEl.innerHTML = "Tudo certo, conecte-se de novo à sua rede e continue!"

                        return
                    }

                    respEl.classList.add("text-danger")
                    respEl.innerHTML = "Você nã está conectado à rede AMEE! <br> Conecte-se e recarregue esta página"
                }
            }
        
            xmlHttp.open("POST", '/config');
            xmlHttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded')
            xmlHttp.send(`ssid=${ssid}&pass=${pass}&name=${name}&tension=${tension}&power=${power}`)
        })
    </script>
</body>
</html>